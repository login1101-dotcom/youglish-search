<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>母音抽出＋例語再生（USのみ・ローカル音源）</title>
<style>
  :root{
    --bg:#fafafa; --card:#fff; --ink:#222; --muted:#666;
    --accent:#0b74ff; --chip:#eef4ff; --red:#d9002b;
    --border:#e7e7e7;
  }
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Ubuntu,"Hiragino Kaku Gothic ProN","Yu Gothic UI","Noto Sans CJK JP",sans-serif}
  .wrap{max-width:900px;margin:32px auto;padding:0 16px}
  header{background:#fff;position:sticky;top:0;border-bottom:1px solid var(--border);z-index:10}
  h1{font-size:20px;margin:0;padding:14px 16px}
  .srch{display:flex;gap:8px;flex-wrap:wrap; margin:12px 0 24px}
  .srch input{flex:1;min-width:220px;padding:12px 14px;border:1px solid var(--border);border-radius:10px;font-size:16px}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer}
  .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
  .sec{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px 14px;margin:16px 0}
  .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .ipa{font-family: "Noto Serif", "Times New Roman", serif; font-size:22px; letter-spacing:.5px}
  .ipa .vwl{color:var(--red);font-weight:700}
  .muted{color:var(--muted);font-size:13px}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border:1px solid var(--border);padding:8px;text-align:center}
  th{background:#f5f5f5}
</style>
</head>
<body>
<header><h1>母音抽出＋例語再生（USのみ・ローカル音源）</h1></header>
<div class="wrap">
  <div class="srch">
    <input id="q" placeholder="単語（例: dog, camp, are, cat ...）" />
    <button class="btn primary" id="btn">検索</button>
  </div>

  <section class="sec" id="sec-ipa">
    <div class="muted">IPA比較（左:Wiktionary / 中:dictionaryapi.dev / 右:正規化17母音）</div>
    <table>
      <thead>
        <tr><th>Wiktionary</th><th>dictionaryapi.dev</th><th>正規化</th></tr>
      </thead>
      <tbody id="ipaTable"><tr><td>—</td><td>—</td><td>—</td></tr></tbody>
    </table>
  </section>
</div>

<script>
/* ===== IPA正規化用17カテゴリ ===== */
const IPA_TO_CATEGORY = {
  "ɪ":"short i","i":"long e","iː":"long e",
  "ɛ":"short e","æ":"short a","eɪ":"long a",
  "ʊ":"short oo","u":"long u","uː":"long u",
  "ɑ":"short o","ɑː":"short o","ɒ":"short o","ɔ":"short o",
  "oʊ":"long o","əʊ":"long o",
  "ɑr":"ar sound","ɑːr":"ar sound",
  "ɔr":"or sound","ɔːr":"or sound",
  "ɝ":"er sound","ɜː":"er sound","ɚ":"schwa+r",
  "aɪ":"ai sound","aʊ":"au sound","ɔɪ":"oi sound",
  "ə":"schwa"
};
const SPECIAL_SPLIT = {"iə":["short i","er sound"],"eə":["short e","er sound"],"ʊə":["short oo","er sound"]};

/* ===== 取得 ===== */
async function fetchDictAPI(word){
  try{
    const url=`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`;
    const r=await fetch(url); if(!r.ok) throw new Error("dictAPI error");
    const js=await r.json();
    const out=[];
    js.forEach(e=>{
      if(e.phonetics){ e.phonetics.forEach(ph=>{if(ph.text) out.push(ph.text);}); }
      if(e.phonetic) out.push(e.phonetic);
    });
    return [...new Set(out)];
  }catch(e){ return []; }
}

async function fetchWiktionary(word){
  try{
    const url=`https://en.wiktionary.org/w/api.php?action=parse&page=${encodeURIComponent(word)}&prop=text&format=json&origin=*`;
    const r=await fetch(url); if(!r.ok) throw new Error("wiki error");
    const js=await r.json();
    const html=js.parse.text["*"];
    const div=document.createElement("div"); div.innerHTML=html;
    const spans=[...div.querySelectorAll("span.IPA")].map(x=>x.textContent.trim());
    return [...new Set(spans)];
  }catch(e){ return []; }
}

/* ===== 正規化 ===== */
function normalizeIPA(ipa){
  if(!ipa) return "—";
  let toks=ipa.replace(/[ˈˌ.\[\]]/g,"").split(/[\s/]+/).filter(Boolean);
  const cats=[];
  for(const t of toks){
    if(SPECIAL_SPLIT[t]){ cats.push(...SPECIAL_SPLIT[t]); continue; }
    const cat=IPA_TO_CATEGORY[t];
    if(cat) cats.push(cat);
  }
  return cats.length?("/"+cats.join(" ")+"/"):"—";
}

/* ===== 表示 ===== */
async function run(){
  const w=document.getElementById("q").value.trim(); if(!w) return;
  const [wiki,dapi]=await Promise.all([fetchWiktionary(w),fetchDictAPI(w)]);
  const wikiIPA=wiki.length?wiki[0]:"—";
  const dapiIPA=dapi.length?dapi[0]:"—";
  const norm=normalizeIPA(dapiIPA||wikiIPA);
  const row=`<tr><td>${wikiIPA}</td><td>${dapiIPA}</td><td>${norm}</td></tr>`;
  document.getElementById("ipaTable").innerHTML=row;
}

document.getElementById("btn").addEventListener("click",run);
document.getElementById("q").addEventListener("keydown",e=>{if(e.key==="Enter")run();});
</script>
</body>
</html>
