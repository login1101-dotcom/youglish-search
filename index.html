<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Youglish Search</title>
  <style>
    body { font-family: sans-serif; background:#fff; color:#000; }
    .red { color: red; font-weight: bold; }
    .block { margin:12px 0; }
    button { margin:4px; padding:6px 12px; }
  </style>
</head>
<body>
  <h1>発音チェック</h1>
  <div class="block">
    <input id="wordInput" type="text" placeholder="単語を入力">
    <button onclick="lookup()">検索</button>
  </div>
  <div class="block" id="ipaArea"></div>
  <div class="block" id="normArea"></div>
  <div class="block" id="examplesArea"></div>

<script>
const VOWEL_MAP = [
  {ipa:"æ", norm:"æ", label:"short a /æ/", ex:["cat","camp","bath"], file:"short_a"},
  {ipa:"e", norm:"e", label:"short e /e/", ex:["bed","red","pen"], file:"short_e"},
  {ipa:"ɪ", norm:"ɪ", label:"short i /ɪ/", ex:["sit","fish","milk"], file:"short_i"},
  {ipa:"ʊ", norm:"ʊ", label:"short oo /ʊ/", ex:["book","good","put"], file:"short_oo"},
  {ipa:"ʌ", norm:"ʌ", label:"short u /ʌ/", ex:["but","sun","up"], file:"short_u"},
  {ipa:"iː", norm:"iː", label:"long e /iː/", ex:["see","tree","green"], file:"long_e"},
  {ipa:"ɑː", norm:"ɑː", label:"long a /ɑː/", ex:["father","car"], file:"long_a"},
  {ipa:"uː", norm:"uː", label:"long oo /uː/", ex:["too","loose","through"], file:"long_oo"},
  {ipa:"ɔː", norm:"ɔː", label:"aw sound /ɔː/", ex:["law","caught","dog"], file:"aw_sound"},
  {ipa:"eɪ", norm:"eɪ", label:"long a /eɪ/", ex:["make","name"], file:"long_a"},
  {ipa:"oʊ", norm:"oʊ", label:"long o /oʊ/", ex:["go","home"], file:"long_o"},
  {ipa:"aɪ", norm:"aɪ", label:"long i /aɪ/", ex:["time","five"], file:"long_i"},
  {ipa:"aʊ", norm:"aʊ", label:"ow sound /aʊ/", ex:["out","cow"], file:"ow_sound"},
  {ipa:"ɔɪ", norm:"ɔɪ", label:"oi sound /ɔɪ/", ex:["boy","coin"], file:"oi_sound"},
  {ipa:"ɝː", norm:"ɝː", label:"er sound /ɝː/", ex:["bird","her"], file:"er_sound"},
  {ipa:"ɑːr", norm:"ɑːr", label:"ar sound /ɑːr/", ex:["car","art"], file:"ar_sound"},
  {ipa:"ɔːr", norm:"ɔːr", label:"or sound /ɔːr/", ex:["for","storm"], file:"or_sound"},
];

async function lookup(){
  const w = document.getElementById("wordInput").value.trim();
  if(!w) return;

  // IPA取得
  let ipa = "";
  try {
    const r = await fetch("https://api.dictionaryapi.dev/api/v2/entries/en/"+encodeURIComponent(w));
    const j = await r.json();
    ipa = j[0]?.phonetics?.[0]?.text || "";
  } catch(e){ ipa=""; }

  // IPAそのまま
  const wikiUrl = "https://en.wiktionary.org/wiki/" + encodeURIComponent(w);
  document.getElementById("ipaArea").innerHTML =
    `<b>辞書IPA:</b> <button onclick="playWord('${w}')">${ipa||"(なし)"}</button> 
     <a href="${wikiUrl}" target="_blank">Wiktionary</a>`;

  // 正規化して赤字化
  let highlighted = ipa;
  let matched = null;
  for(const v of VOWEL_MAP){
    const re = new RegExp(v.ipa,"g");
    if(re.test(ipa)){
      highlighted = highlighted.replace(re, `<span class="red">${v.ipa}</span>`);
      matched = v;
      break;
    }
  }
  document.getElementById("normArea").innerHTML =
    `<b>発音記号:</b> ${matched ? highlighted+" → "+matched.label : "(未分類)"}`;

  // 例単語
  if(matched){
    const exHtml = matched.ex.map(e =>
      `<button onclick="playWord('${e}')">${e}</button>`).join(" ");
    document.getElementById("examplesArea").innerHTML =
      `<b>例単語:</b> ${exHtml}`;
  } else {
    document.getElementById("examplesArea").innerHTML="";
  }
}

// 再生関数
function playWord(w){
  let urlVowel = "/audio/vowels/"+w+".mp3";
  let urlWord = "/audio/words/"+w+".mp3";
  const a = new Audio();
  a.src = (w.includes("_sound")||w.startsWith("long")||w.startsWith("short")) ? urlVowel : urlWord;
  a.play();
}
</script>
</body>
</html>
