<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Oxford + Cambridge + 正規化</title>
  <style>
    body { font-family: sans-serif; margin:20px; }
    h1 { font-size: 18px; }
    table { border-collapse: collapse; width: 100%; margin-top: 12px; }
    th, td { border: 1px solid #ccc; padding: 8px; vertical-align: top; }
    th { background: #f3f4f6; }
  </style>
</head>
<body>
  <h1>IPA (Oxford / Cambridge / 正規化)</h1>
  <input id="word" value="cat">
  <button onclick="lookup()">検索</button>

  <table>
    <thead>
      <tr>
        <th>Oxford</th>
        <th>Cambridge</th>
        <th>正規化</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td id="oxfordCell">—</td>
        <td id="cambridgeCell">—</td>
        <td id="normalizedCell">—</td>
      </tr>
    </tbody>
  </table>

  <script>
    const OXFORD_APP_ID = "あなたのAPP_ID";
    const OXFORD_APP_KEY = "あなたのAPP_KEY";

    async function fetchOxford(word) {
      const url = `https://od-api.oxforddictionaries.com/api/v2/entries/en-us/${word.toLowerCase()}`;
      try {
        const res = await fetch(url, {
          headers: { "app_id": OXFORD_APP_ID, "app_key": OXFORD_APP_KEY }
        });
        if (!res.ok) return "—";
        const data = await res.json();
        const out = [];
        (data.results||[]).forEach(r=>{
          (r.lexicalEntries||[]).forEach(lex=>{
            (lex.entries||[]).forEach(e=>{
              (e.pronunciations||[]).forEach(p=>{
                if(p.phoneticSpelling) out.push(p.phoneticSpelling);
              });
            });
          });
        });
        return [...new Set(out)].join(" | ") || "—";
      } catch(e) { return "—"; }
    }

    async function fetchCambridge(word) {
      // 公式APIなし → リンクを表示する形にする
      return `🔗 <a href="https://dictionary.cambridge.org/dictionary/english/${word}" target="_blank">Cambridgeで見る</a>`;
    }

    function normalizeIPA(ipa) {
      if (!ipa || ipa==="—") return "—";
      let s = ipa;
      if (/æ/.test(s)) return "short a";
      if (/ɑ|ɒ|ɔ/.test(s)) return "short o";
      if (/ɪ/.test(s)) return "short i";
      if (/ʊ/.test(s)) return "short oo";
      if (/ʌ/.test(s)) return "short u";
      if (/ə/.test(s)) return "schwa";
      if (/ɑːr|ɑr/.test(s)) return "ar sound";
      if (/ɔːr|ɔr/.test(s)) return "or sound";
      if (/ɚ|ɝ|ər/.test(s)) return "er sound";
      if (/ʊə/.test(s)) return "short oo + er sound";
      if (/ɪə/.test(s)) return "short i + er sound";
      if (/eə/.test(s)) return "short e + er sound";
      return s;
    }

    async function lookup() {
      const word = document.getElementById("word").value.trim();
      if (!word) return;
      document.getElementById("oxfordCell").textContent = "…";
      document.getElementById("cambridgeCell").textContent = "…";
      document.getElementById("normalizedCell").textContent = "…";

      const oxford = await fetchOxford(word);
      document.getElementById("oxfordCell").textContent = oxford;
      const cambridge = await fetchCambridge(word);
      document.getElementById("cambridgeCell").innerHTML = cambridge;
      document.getElementById("normalizedCell").textContent = normalizeIPA(oxford);
    }
  </script>
</body>
</html>
